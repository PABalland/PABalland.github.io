<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualization</title>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            font-family: sans-serif;
            overflow: hidden;
        }

        #container {
            display: flex;
            width: 100%;
            height: 100vh;
        }

        #viz-container {
            width: 88%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        #legend-container {
            width: 12%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px 0;
            box-sizing: border-box;
        }



        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border: 1px solid #ccc;
            padding: 8px;
            border-radius: 4px;
            pointer-events: none;
            font-size: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 10;
        }

        #legend-title {
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            font-size: 14px;
        }

        .axis-label {
            font-size: 10px;
        }
    </style>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>

    <div id="container">
        <div id="viz-container">
            <div id="tooltip" class="tooltip"></div>
        </div>
        <div id="legend-container">
            <div id="legend-title">Complementarity</div>
            <div id="legend"></div>
        </div>
    </div>

    <script>
        async function drawViz() {
            const data =  [
  {
    "from": "Canada (CA)",
    "to": "European Union (EU)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 767407,
    "binary": 2187,
    "expected": 1150.01,
    "untapped": -9784.99,
    "links.rca": 9.51,
    "sum_from": 128011,
    "sum_to": 658919,
    "binary.pc": 1.0213,
    "th.max": 393465,
    "th.max.pc": 0.1074,
    "RD": 22.86,
    "RD.added": 16.02,
    "value": 16.02
  },
  {
    "from": "Canada (CA)",
    "to": "India (IN)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 145264,
    "binary": 448,
    "expected": 644.85,
    "untapped": -1595.15,
    "links.rca": 3.47,
    "sum_from": 128011,
    "sum_to": 313249,
    "binary.pc": 0.2092,
    "th.max": 220630,
    "th.max.pc": 0.0602,
    "RD": 22.86,
    "RD.added": 63.96,
    "value": 63.96
  },
  {
    "from": "Canada (CA)",
    "to": "Japan (JP)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 1692,
    "binary": 304,
    "expected": 373.48,
    "untapped": -1146.52,
    "links.rca": 4.07,
    "sum_from": 128011,
    "sum_to": 127554,
    "binary.pc": 0.142,
    "th.max": 127782.5,
    "th.max.pc": 0.0349,
    "RD": 22.86,
    "RD.added": 38.66,
    "value": 38.66
  },
  {
    "from": "Canada (CA)",
    "to": "South Korea (KR)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 5997,
    "binary": 563,
    "expected": 348.79,
    "untapped": -2466.21,
    "links.rca": 8.07,
    "sum_from": 128011,
    "sum_to": 110663,
    "binary.pc": 0.2629,
    "th.max": 119337,
    "th.max.pc": 0.0326,
    "RD": 22.86,
    "RD.added": 58.27,
    "value": 58.27
  },
  {
    "from": "Canada (CA)",
    "to": "United Kingdom (GB)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 19920,
    "binary": 1104,
    "expected": 366.62,
    "untapped": -5153.38,
    "links.rca": 15.06,
    "sum_from": 128011,
    "sum_to": 122862,
    "binary.pc": 0.5156,
    "th.max": 125436.5,
    "th.max.pc": 0.0342,
    "RD": 22.86,
    "RD.added": 3.78,
    "value": 3.78
  },
  {
    "from": "Canada (CA)",
    "to": "United States (US)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 2736674,
    "binary": 3195,
    "expected": 717.93,
    "untapped": -15257.07,
    "links.rca": 22.25,
    "sum_from": 128011,
    "sum_to": 363258,
    "binary.pc": 1.492,
    "th.max": 245634.5,
    "th.max.pc": 0.0671,
    "RD": 22.86,
    "RD.added": 3.57,
    "value": 3.57
  },
  {
    "from": "European Union (EU)",
    "to": "Canada (CA)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 767407,
    "binary": 2187,
    "expected": 1150.01,
    "untapped": -9784.99,
    "links.rca": 9.51,
    "sum_from": 128011,
    "sum_to": 658919,
    "binary.pc": 1.0213,
    "th.max": 393465,
    "th.max.pc": 0.1074,
    "RD": 36.39,
    "RD.added": 2.49,
    "value": 2.49
  },
  {
    "from": "European Union (EU)",
    "to": "India (IN)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 144210,
    "binary": 2098,
    "expected": 1420.71,
    "untapped": -9069.29,
    "links.rca": 7.38,
    "sum_from": 658919,
    "sum_to": 313249,
    "binary.pc": 0.9798,
    "th.max": 486084,
    "th.max.pc": 0.1327,
    "RD": 36.39,
    "RD.added": 58.1,
    "value": 58.1
  },
  {
    "from": "European Union (EU)",
    "to": "Japan (JP)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 19825,
    "binary": 1538,
    "expected": 1149.34,
    "untapped": -6540.66,
    "links.rca": 6.69,
    "sum_from": 658919,
    "sum_to": 127554,
    "binary.pc": 0.7182,
    "th.max": 393236.5,
    "th.max.pc": 0.1073,
    "RD": 36.39,
    "RD.added": 30.95,
    "value": 30.95
  },
  {
    "from": "European Union (EU)",
    "to": "South Korea (KR)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 12919,
    "binary": 976,
    "expected": 1124.65,
    "untapped": -3755.35,
    "links.rca": 4.34,
    "sum_from": 658919,
    "sum_to": 110663,
    "binary.pc": 0.4558,
    "th.max": 384791,
    "th.max.pc": 0.105,
    "RD": 36.39,
    "RD.added": 50.46,
    "value": 50.46
  },
  {
    "from": "European Union (EU)",
    "to": "United Kingdom (GB)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 168775,
    "binary": 7025,
    "expected": 1142.48,
    "untapped": -33982.52,
    "links.rca": 30.74,
    "sum_from": 658919,
    "sum_to": 122862,
    "binary.pc": 3.2806,
    "th.max": 390890.5,
    "th.max.pc": 0.1067,
    "RD": 36.39,
    "RD.added": 3.29,
    "value": 3.29
  },
  {
    "from": "European Union (EU)",
    "to": "United States (US)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 2543124,
    "binary": 10750,
    "expected": 1493.79,
    "untapped": -52256.21,
    "links.rca": 35.98,
    "sum_from": 658919,
    "sum_to": 363258,
    "binary.pc": 5.0202,
    "th.max": 511088.5,
    "th.max.pc": 0.1395,
    "RD": 36.39,
    "RD.added": 3.16,
    "value": 3.16
  },
  {
    "from": "India (IN)",
    "to": "Canada (CA)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 145264,
    "binary": 448,
    "expected": 644.85,
    "untapped": -1595.15,
    "links.rca": 3.47,
    "sum_from": 128011,
    "sum_to": 313249,
    "binary.pc": 0.2092,
    "th.max": 220630,
    "th.max.pc": 0.0602,
    "RD": 73.79,
    "RD.added": 13.03,
    "value": 13.03
  },
  {
    "from": "India (IN)",
    "to": "European Union (EU)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 144210,
    "binary": 2098,
    "expected": 1420.71,
    "untapped": -9069.29,
    "links.rca": 7.38,
    "sum_from": 658919,
    "sum_to": 313249,
    "binary.pc": 0.9798,
    "th.max": 486084,
    "th.max.pc": 0.1327,
    "RD": 73.79,
    "RD.added": 20.7,
    "value": 20.7
  },
  {
    "from": "India (IN)",
    "to": "Japan (JP)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 4589,
    "binary": 253,
    "expected": 644.18,
    "untapped": -620.82,
    "links.rca": 1.96,
    "sum_from": 313249,
    "sum_to": 127554,
    "binary.pc": 0.1181,
    "th.max": 220401.5,
    "th.max.pc": 0.0602,
    "RD": 73.79,
    "RD.added": 16.85,
    "value": 16.85
  },
  {
    "from": "India (IN)",
    "to": "South Korea (KR)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 2710,
    "binary": 409,
    "expected": 619.5,
    "untapped": -1425.5,
    "links.rca": 3.3,
    "sum_from": 313249,
    "sum_to": 110663,
    "binary.pc": 0.191,
    "th.max": 211956,
    "th.max.pc": 0.0579,
    "RD": 73.79,
    "RD.added": 14.79,
    "value": 14.79
  },
  {
    "from": "India (IN)",
    "to": "United Kingdom (GB)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 16772,
    "binary": 985,
    "expected": 637.32,
    "untapped": -4287.68,
    "links.rca": 7.73,
    "sum_from": 313249,
    "sum_to": 122862,
    "binary.pc": 0.46,
    "th.max": 218055.5,
    "th.max.pc": 0.0595,
    "RD": 73.79,
    "RD.added": 13.44,
    "value": 13.44
  },
  {
    "from": "India (IN)",
    "to": "United States (US)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 492086,
    "binary": 2711,
    "expected": 988.63,
    "untapped": -12566.37,
    "links.rca": 13.71,
    "sum_from": 313249,
    "sum_to": 363258,
    "binary.pc": 1.266,
    "th.max": 338253.5,
    "th.max.pc": 0.0923,
    "RD": 73.79,
    "RD.added": 12.27,
    "value": 12.27
  },
  {
    "from": "Japan (JP)",
    "to": "Canada (CA)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 1692,
    "binary": 304,
    "expected": 373.48,
    "untapped": -1146.52,
    "links.rca": 4.07,
    "sum_from": 128011,
    "sum_to": 127554,
    "binary.pc": 0.142,
    "th.max": 127782.5,
    "th.max.pc": 0.0349,
    "RD": 52.51,
    "RD.added": 9.01,
    "value": 9.01
  },
  {
    "from": "Japan (JP)",
    "to": "European Union (EU)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 19825,
    "binary": 1538,
    "expected": 1149.34,
    "untapped": -6540.66,
    "links.rca": 6.69,
    "sum_from": 658919,
    "sum_to": 127554,
    "binary.pc": 0.7182,
    "th.max": 393236.5,
    "th.max.pc": 0.1073,
    "RD": 52.51,
    "RD.added": 14.84,
    "value": 14.84
  },
  {
    "from": "Japan (JP)",
    "to": "India (IN)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 4589,
    "binary": 253,
    "expected": 644.18,
    "untapped": -620.82,
    "links.rca": 1.96,
    "sum_from": 313249,
    "sum_to": 127554,
    "binary.pc": 0.1181,
    "th.max": 220401.5,
    "th.max.pc": 0.0602,
    "RD": 52.51,
    "RD.added": 38.13,
    "value": 38.13
  },
  {
    "from": "Japan (JP)",
    "to": "South Korea (KR)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 1780,
    "binary": 268,
    "expected": 348.13,
    "untapped": -991.87,
    "links.rca": 3.85,
    "sum_from": 127554,
    "sum_to": 110663,
    "binary.pc": 0.1252,
    "th.max": 119108.5,
    "th.max.pc": 0.0325,
    "RD": 52.51,
    "RD.added": 23.66,
    "value": 23.66
  },
  {
    "from": "Japan (JP)",
    "to": "United Kingdom (GB)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 4596,
    "binary": 554,
    "expected": 365.95,
    "untapped": -2404.05,
    "links.rca": 7.57,
    "sum_from": 127554,
    "sum_to": 122862,
    "binary.pc": 0.2587,
    "th.max": 125208,
    "th.max.pc": 0.0342,
    "RD": 52.51,
    "RD.added": 5.86,
    "value": 5.86
  },
  {
    "from": "Japan (JP)",
    "to": "United States (US)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 17440,
    "binary": 1493,
    "expected": 717.26,
    "untapped": -6747.74,
    "links.rca": 10.41,
    "sum_from": 127554,
    "sum_to": 363258,
    "binary.pc": 0.6972,
    "th.max": 245406,
    "th.max.pc": 0.067,
    "RD": 52.51,
    "RD.added": 4.31,
    "value": 4.31
  },
  {
    "from": "South Korea (KR)",
    "to": "Canada (CA)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 5997,
    "binary": 563,
    "expected": 348.79,
    "untapped": -2466.21,
    "links.rca": 8.07,
    "sum_from": 128011,
    "sum_to": 110663,
    "binary.pc": 0.2629,
    "th.max": 119337,
    "th.max.pc": 0.0326,
    "RD": 73.9,
    "RD.added": 7.23,
    "value": 7.23
  },
  {
    "from": "South Korea (KR)",
    "to": "European Union (EU)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 12919,
    "binary": 976,
    "expected": 1124.65,
    "untapped": -3755.35,
    "links.rca": 4.34,
    "sum_from": 658919,
    "sum_to": 110663,
    "binary.pc": 0.4558,
    "th.max": 384791,
    "th.max.pc": 0.105,
    "RD": 73.9,
    "RD.added": 12.95,
    "value": 12.95
  },
  {
    "from": "South Korea (KR)",
    "to": "India (IN)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 2710,
    "binary": 409,
    "expected": 619.5,
    "untapped": -1425.5,
    "links.rca": 3.3,
    "sum_from": 313249,
    "sum_to": 110663,
    "binary.pc": 0.191,
    "th.max": 211956,
    "th.max.pc": 0.0579,
    "RD": 73.9,
    "RD.added": 14.68,
    "value": 14.68
  },
  {
    "from": "South Korea (KR)",
    "to": "Japan (JP)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 1780,
    "binary": 268,
    "expected": 348.13,
    "untapped": -991.87,
    "links.rca": 3.85,
    "sum_from": 127554,
    "sum_to": 110663,
    "binary.pc": 0.1252,
    "th.max": 119108.5,
    "th.max.pc": 0.0325,
    "RD": 73.9,
    "RD.added": 2.27,
    "value": 2.27
  },
  {
    "from": "South Korea (KR)",
    "to": "United Kingdom (GB)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 3718,
    "binary": 472,
    "expected": 341.27,
    "untapped": -2018.73,
    "links.rca": 6.92,
    "sum_from": 110663,
    "sum_to": 122862,
    "binary.pc": 0.2204,
    "th.max": 116762.5,
    "th.max.pc": 0.0319,
    "RD": 73.9,
    "RD.added": 7.22,
    "value": 7.22
  },
  {
    "from": "South Korea (KR)",
    "to": "United States (US)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 18173,
    "binary": 2066,
    "expected": 692.58,
    "untapped": -9637.42,
    "links.rca": 14.92,
    "sum_from": 110663,
    "sum_to": 363258,
    "binary.pc": 0.9648,
    "th.max": 236960.5,
    "th.max.pc": 0.0647,
    "RD": 73.9,
    "RD.added": 5.73,
    "value": 5.73
  },
  {
    "from": "United Kingdom (GB)",
    "to": "Canada (CA)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 19920,
    "binary": 1104,
    "expected": 366.62,
    "untapped": -5153.38,
    "links.rca": 15.06,
    "sum_from": 128011,
    "sum_to": 122862,
    "binary.pc": 0.5156,
    "th.max": 125436.5,
    "th.max.pc": 0.0342,
    "RD": 21.88,
    "RD.added": 4.76,
    "value": 4.76
  },
  {
    "from": "United Kingdom (GB)",
    "to": "European Union (EU)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 168775,
    "binary": 7025,
    "expected": 1142.48,
    "untapped": -33982.52,
    "links.rca": 30.74,
    "sum_from": 658919,
    "sum_to": 122862,
    "binary.pc": 3.2806,
    "th.max": 390890.5,
    "th.max.pc": 0.1067,
    "RD": 21.88,
    "RD.added": 17.8,
    "value": 17.8
  },
  {
    "from": "United Kingdom (GB)",
    "to": "India (IN)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 16772,
    "binary": 985,
    "expected": 637.32,
    "untapped": -4287.68,
    "links.rca": 7.73,
    "sum_from": 313249,
    "sum_to": 122862,
    "binary.pc": 0.46,
    "th.max": 218055.5,
    "th.max.pc": 0.0595,
    "RD": 21.88,
    "RD.added": 65.35,
    "value": 65.35
  },
  {
    "from": "United Kingdom (GB)",
    "to": "Japan (JP)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 4596,
    "binary": 554,
    "expected": 365.95,
    "untapped": -2404.05,
    "links.rca": 7.57,
    "sum_from": 127554,
    "sum_to": 122862,
    "binary.pc": 0.2587,
    "th.max": 125208,
    "th.max.pc": 0.0342,
    "RD": 21.88,
    "RD.added": 36.48,
    "value": 36.48
  },
  {
    "from": "United Kingdom (GB)",
    "to": "South Korea (KR)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 3718,
    "binary": 472,
    "expected": 341.27,
    "untapped": -2018.73,
    "links.rca": 6.92,
    "sum_from": 110663,
    "sum_to": 122862,
    "binary.pc": 0.2204,
    "th.max": 116762.5,
    "th.max.pc": 0.0319,
    "RD": 21.88,
    "RD.added": 59.23,
    "value": 59.23
  },
  {
    "from": "United Kingdom (GB)",
    "to": "United States (US)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 132332,
    "binary": 4819,
    "expected": 710.41,
    "untapped": -23384.59,
    "links.rca": 33.92,
    "sum_from": 122862,
    "sum_to": 363258,
    "binary.pc": 2.2504,
    "th.max": 243060,
    "th.max.pc": 0.0664,
    "RD": 21.88,
    "RD.added": 1.46,
    "value": 1.46
  },
  {
    "from": "United States (US)",
    "to": "Canada (CA)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 2736674,
    "binary": 3195,
    "expected": 717.93,
    "untapped": -15257.07,
    "links.rca": 22.25,
    "sum_from": 128011,
    "sum_to": 363258,
    "binary.pc": 1.492,
    "th.max": 245634.5,
    "th.max.pc": 0.0671,
    "RD": 18.23,
    "RD.added": 8.2,
    "value": 8.2
  },
  {
    "from": "United States (US)",
    "to": "European Union (EU)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 2543124,
    "binary": 10750,
    "expected": 1493.79,
    "untapped": -52256.21,
    "links.rca": 35.98,
    "sum_from": 658919,
    "sum_to": 363258,
    "binary.pc": 5.0202,
    "th.max": 511088.5,
    "th.max.pc": 0.1395,
    "RD": 18.23,
    "RD.added": 21.32,
    "value": 21.32
  },
  {
    "from": "United States (US)",
    "to": "India (IN)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 492086,
    "binary": 2711,
    "expected": 988.63,
    "untapped": -12566.37,
    "links.rca": 13.71,
    "sum_from": 313249,
    "sum_to": 363258,
    "binary.pc": 1.266,
    "th.max": 338253.5,
    "th.max.pc": 0.0923,
    "RD": 18.23,
    "RD.added": 67.83,
    "value": 67.83
  },
  {
    "from": "United States (US)",
    "to": "Japan (JP)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 17440,
    "binary": 1493,
    "expected": 717.26,
    "untapped": -6747.74,
    "links.rca": 10.41,
    "sum_from": 127554,
    "sum_to": 363258,
    "binary.pc": 0.6972,
    "th.max": 245406,
    "th.max.pc": 0.067,
    "RD": 18.23,
    "RD.added": 38.59,
    "value": 38.59
  },
  {
    "from": "United States (US)",
    "to": "South Korea (KR)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 18173,
    "binary": 2066,
    "expected": 692.58,
    "untapped": -9637.42,
    "links.rca": 14.92,
    "sum_from": 110663,
    "sum_to": 363258,
    "binary.pc": 0.9648,
    "th.max": 236960.5,
    "th.max.pc": 0.0647,
    "RD": 18.23,
    "RD.added": 61.39,
    "value": 61.39
  },
  {
    "from": "United States (US)",
    "to": "United Kingdom (GB)",
    "domain": "Computer Vision, Language Processing & Object Recognition",
    "full": 132332,
    "binary": 4819,
    "expected": 710.41,
    "untapped": -23384.59,
    "links.rca": 33.92,
    "sum_from": 122862,
    "sum_to": 363258,
    "binary.pc": 2.2504,
    "th.max": 243060,
    "th.max.pc": 0.0664,
    "RD": 18.23,
    "RD.added": 5.11,
    "value": 5.11
  }
] 

            const froms = Array.from(new Set(data.map(d => d.from))).sort();
            const tos = Array.from(new Set(data.map(d => d.to))).sort();

            const vizContainer = document.getElementById('viz-container');
            const legendContainer = document.getElementById('legend-container');
            const tooltip = d3.select("#tooltip");

            d3.select("#viz-container svg").remove();
            d3.select("#legend svg").remove();

            const width = vizContainer.clientWidth;
            const height = vizContainer.clientHeight;
            const margin = { top: 50, right: 50, bottom: 100, left: 150 };
            const availableWidth = width - margin.left - margin.right;
            const availableHeight = height - margin.top - margin.bottom;

            const size = Math.min(availableWidth, availableHeight);

            const svg = d3.select("#viz-container")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${margin.left + (availableWidth - size) / 2}, ${margin.top + (availableHeight - size) / 2})`);

            const x = d3.scaleBand()
                .range([0, size])
                .domain(tos)
                .padding(0.01);

            const y = d3.scaleBand()
                .range([0, size])
                .domain(froms)
                .padding(0.01);

            const maxVal = d3.max(data, d => d.value);
            const color = d3.scaleLinear()
                .domain([0, maxVal])
                .range(["#ffffff", "#376bbe"]);

            svg.append("g")
                .attr("transform", "translate(0," + size + ")")
                .call(d3.axisBottom(x))
                .selectAll("text")
                .attr("transform", "translate(-10,0)rotate(-45)")
                .style("text-anchor", "end")
                .style("font-size", "10px");

            svg.append("g")
                .call(d3.axisLeft(y))
                .style("font-size", "10px");

            svg.selectAll()
                .data(data, function (d) { return d.isKey ? (d.from + ':' + d.to) : (this.id); })
                .enter()
                .append("rect")
                .attr("x", function (d) { return x(d.to) })
                .attr("y", function (d) { return y(d.from) })
                .attr("width", x.bandwidth())
                .attr("height", y.bandwidth())
                .style("fill", function (d) {
                    return d.from === d.to ? "#8f9194" : color(d.value);
                })
                .style("stroke", "#eee")
                .style("stroke-width", 1)
                .on("mouseover", function (event, d) {
                    d3.select(this).style("stroke", "black").style("stroke-width", 2);
                    tooltip.style("opacity", 1);
                    tooltip.html(`From: <b>${d.from}</b><br>To: <b>${d.to}</b><br>Value: <b>${d.value}</b>`);
                    tooltip.style("left", (event.pageX + 15) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mousemove", function (event) {
                    tooltip.style("left", (event.pageX + 15) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseleave", function (d) {
                    d3.select(this).style("stroke", "#eee").style("stroke-width", 1);
                    tooltip.style("opacity", 0);
                });

            const legendHeight = size * 0.8;
            const legendWidth = Math.max(10, size * 0.04);
            const legendFontSize = Math.max(10, size * 0.02);

            d3.select("#legend-title")
                .style("font-size", Math.max(9, size * 0.018) + "px")
                .style("margin-bottom", Math.max(10, size * 0.02) + "px");

            const legendSvg = d3.select("#legend")
                .append("svg")
                .attr("width", legendWidth + 60)
                .attr("height", legendHeight + 20);

            const defs = legendSvg.append("defs");
            const linearGradient = defs.append("linearGradient")
                .attr("id", "linear-gradient");

            linearGradient
                .attr("x1", "0%")
                .attr("y1", "100%")
                .attr("x2", "0%")
                .attr("y2", "0%");

            linearGradient.append("stop")
                .attr("offset", "0%")
                .attr("stop-color", "#ffffff");

            linearGradient.append("stop")
                .attr("offset", "100%")
                .attr("stop-color", "#376bbe");

            legendSvg.append("rect")
                .attr("width", legendWidth)
                .attr("height", legendHeight)
                .style("fill", "url(#linear-gradient)")
                .style("stroke", "#ccc")
                .attr("transform", "translate(0, 10)");

            const legendScale = d3.scaleLinear()
                .domain([0, maxVal])
                .range([legendHeight, 0]);

            const legendAxis = d3.axisRight(legendScale)
                .ticks(5);

            legendSvg.append("g")
                .attr("class", "legend-axis")
                .attr("transform", `translate(${legendWidth}, 10)`)
                .call(legendAxis)
                .style("font-size", legendFontSize + "px");

        }

        drawViz();
        window.addEventListener('resize', drawViz);

    </script>
</body>

</html>
