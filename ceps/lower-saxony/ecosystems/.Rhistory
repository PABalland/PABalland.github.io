# SELECTORS
data = "openalex"
data = "regpat"
#data = "crunchbase"
p = "5-lower-saxony"
j <- "nuts2_ls"  # GEO
root = "~/Library/CloudStorage/Dropbox/1-asg/1-build"
dir = paste0(root, "/3-projects/", p) # WHERE DATA LOADS
i <- "kst" # "topic"; "wipo"; "all"; "aiw"
# CODE
library(data.table)
library(jsonlite)
library(stringr)
library(dplyr)
setwd("~/Library/CloudStorage/Dropbox/1-asg/1-build/2-code")
source("save.to.directory.R")
source("get_rca_colors.R")
# LOAD PARENTS
setwd(paste0(dir, "/0-custom/domain/", i))
parents <- unique(fread("index.csv")[, c("domain", "parent")])
# ORG-DOMAIN FILES
setwd(paste0(dir, "/3-viz/ecosystems/_source"))
p1 = paste(readLines("part-1.html"), collapse="\n") #before json data
p3 = paste(readLines("part-3.html"), collapse="\n") #after json data
setwd(paste0(dir, "/2-complexity/org/", j, "/", i,  "/", data))
df = read.csv(list.files()[which.max(as.numeric(sub(".*-(\\d{4})\\.csv", "\\1", list.files())))]) # read the latest file
df = merge (df, parents, by = "domain")
df$flag <- ifelse(grepl("\\(.*?\\).*?\\(.*?\\)", df$geo), 1, 0)
if (data == "regpat"){se <- subset (df, df$geo == "Lower Saxony (DE9)")}
if (data == "openalex"){se <- subset (df, df$geo == "Lower Saxony (DE9)")}
if (data == "crunchbase"){se <- subset (df, df$geo == "Lower Saxony (DE9) (DE9)")}
k = unique (se$geo)
df2 = subset (df, df$geo %in% k)
df2$color[df2$parent == "ICT"] = "#365a94"
df2$color[df2$parent == "Climate Tech"] = "#8cab79"
df2$color[df2$parent == "AgriFood Tech"] = "#800020"
df2$color[df2$parent == "Life Sciences"] = "#EEDC82"
df2$color[df2$parent == "Industrial Tech"] = "#e28f26"
df2$color[df2$parent == "Future Mobility"] = "#6a0dad"
df2$color[df2$parent == "Deep Tech" ] = "#669999"
df2$color[df2$parent == "Defense Tech"] = "#8B4513"
#df2 = unique (df2[, c("org", "desc", "count", "domain", "parent", "geo", "color", "parent2")])
df2 = df2[, c("domain", "org", "geo" , "count" ,"parent", "color" )]
#df2 <- df2 %>%
# group_by(org, desc, count, parent, geo, color, parent2) %>%
# summarise(domain = paste(domain, collapse = ", "), .groups = "drop")
#df2 <- df2 %>%
#group_by(org, count, parent, geo, color, parent2) %>%
#summarise(domain = paste(domain, collapse = ", "), .groups = "drop")
df2$org <- gsub("(^|[[:space:]])([[:alpha:]])", "\\1\\U\\2", tolower(df2$org), perl = TRUE)
df2$org[grepl("^Volkswagen", df2$org, ignore.case = TRUE)] <- "Volkswagen Ag"
df2$org[grepl("^Continental", df2$org, ignore.case = TRUE)] <- "Continental Automotive Gmbh"
df2$org[grepl("^Contitech", df2$org, ignore.case = TRUE)] <- "Contitech Ag"
df2$org[grepl("^Amazonen", df2$org, ignore.case = TRUE)] <- "Amazonen-werke H. Dreyer Se & Co. Kg"
df2$org[grepl("^Sartorius", df2$org, ignore.case = TRUE)] <- "Sartorius Stedim Biotech Gmbh"
df2$org[grepl("^Vitesco", df2$org, ignore.case = TRUE)] <- "Vitesco Technologies Gmbh"
df2$org[grepl("^Kws Saat", df2$org, ignore.case = TRUE)] <- "Kws Saat Se & Co. Kgaa"
df2$org[grepl("^Ottobock", df2$org, ignore.case = TRUE)] <- "Ottobock Se & Co. Kgaa"
df2$org[grepl("^Rheinmetall", df2$org, ignore.case = TRUE)] <- "Rheinmetall Waffe Munition Gmbh"
df2$org[grepl("^Abberior", df2$org, ignore.case = TRUE)] <- "Abberior Instruments Gmbh"
df2$org[grepl("^Grimme", df2$org, ignore.case = TRUE)] <- "Grimme Landmaschinenfabrik Gmbh & Co. Kg"
df2$org[grepl("^Vogelsang", df2$org, ignore.case = TRUE)] <- "Vogelsang Gmbh & Co. Kg"
df2$org[grepl("^Focke", df2$org, ignore.case = TRUE)] <- "Focke & Co. (gmbh & Co. Kg)"
df2$org[grepl("^Basf Polyurethanes", df2$org, ignore.case = TRUE)] <- "Basf Polyurethanes Gmbh"
df2$count = ave(df2$count, paste0(df2$org, df2$domain), FUN = sum)
df2 = unique (df2)
dff = df2
dff$count = ave(dff$count, dff$org, FUN = sum)
dff = unique (dff[, c("org", "count")])
### keep only top/snapshot
df_all = df2
df_all <- df_all[order(df_all$domain, -df_all$count), ]
# Step 2: pick one top org per domain, avoiding duplicates when possible
used_orgs <- c()
out <- data.frame()
for(d in unique(df_all$domain)){
tmp <- df_all[df_all$domain == d, ]
# Try to pick first org not yet used
pick <- tmp[!(tmp$org %in% used_orgs), ]
if(nrow(pick) == 0) pick <- tmp[1, ]   # if all orgs used, still take top one
out <- rbind(out, pick[1, ])
used_orgs <- c(used_orgs, pick$org[1])
}
out
capitalize_words <- function(s) {
s <- tolower(s)
s <- gsub("\\b([a-z])", "\\U\\1", s, perl = TRUE)
return(s)
}
out$org = capitalize_words (out$org)
out$count = ave(out$count, out$org, FUN = sum)
out$id = out$org
out$value = out$count
out = unique (out)
dir.create(paste0(dir, "/3-viz/ecosystems/", j, "/", i, "/", data), recursive = TRUE, showWarnings = FALSE)
setwd(paste0(dir, "/3-viz/ecosystems/", j, "/", i, "/", data))
writeLines(paste (p1, toJSON(out, pretty = TRUE), p3, collapse="\n"), paste0("all.html"))
df3 = df2
k = "Batteries"
for (k in unique(df3$domain)){
df2 = subset (df3, df3$domain == k)
capitalize_words <- function(s) {
s <- tolower(s)
s <- gsub("\\b([a-z])", "\\U\\1", s, perl = TRUE)
return(s)
}
df2$org = capitalize_words (df2$org)
df2$count = ave(df2$count, df2$org, FUN = sum)
df2$id = df2$org
df2$value = df2$count
df2 = unique (df2)
k <- tolower (gsub(" ", "-", k))
if (k == "ccs-/-ccu"){ k = "ccs"}
dir.create(paste0(dir, "/3-viz/ecosystems/", j, "/", i, "/", data), recursive = TRUE, showWarnings = FALSE)
setwd(paste0(dir, "/3-viz/ecosystems/", j, "/", i, "/", data))
writeLines(paste (p1, toJSON(df2, pretty = TRUE), p3, collapse="\n"), paste0(k, ".html"))
}
# MISTAKE WITH Anaveon
# SELECTORS
data = "openalex"
data = "regpat"
#data = "crunchbase"
p = "5-lower-saxony"
j <- "nuts2_ls"  # GEO
root = "~/Library/CloudStorage/Dropbox/1-asg/1-build"
dir = paste0(root, "/3-projects/", p) # WHERE DATA LOADS
i <- "kst" # "topic"; "wipo"; "all"; "aiw"
# CODE
library(data.table)
library(jsonlite)
library(stringr)
library(dplyr)
setwd("~/Library/CloudStorage/Dropbox/1-asg/1-build/2-code")
source("save.to.directory.R")
source("get_rca_colors.R")
# LOAD PARENTS
setwd(paste0(dir, "/0-custom/domain/", i))
parents <- unique(fread("index.csv")[, c("domain", "parent")])
# ORG-DOMAIN FILES
setwd(paste0(dir, "/3-viz/ecosystems/_source"))
p1 = paste(readLines("part-1.html"), collapse="\n") #before json data
p3 = paste(readLines("part-3.html"), collapse="\n") #after json data
setwd(paste0(dir, "/2-complexity/org/", j, "/", i,  "/", data))
df = read.csv(list.files()[which.max(as.numeric(sub(".*-(\\d{4})\\.csv", "\\1", list.files())))]) # read the latest file
df = merge (df, parents, by = "domain")
df$flag <- ifelse(grepl("\\(.*?\\).*?\\(.*?\\)", df$geo), 1, 0)
if (data == "regpat"){se <- subset (df, df$geo == "Lower Saxony (DE9)")}
if (data == "openalex"){se <- subset (df, df$geo == "Lower Saxony (DE9)")}
if (data == "crunchbase"){se <- subset (df, df$geo == "Lower Saxony (DE9) (DE9)")}
k = unique (se$geo)
df2 = subset (df, df$geo %in% k)
df2$color[df2$parent == "ICT"] = "#365a94"
df2$color[df2$parent == "Climate Tech"] = "#8cab79"
df2$color[df2$parent == "AgriFood Tech"] = "#800020"
df2$color[df2$parent == "Life Sciences"] = "#EEDC82"
df2$color[df2$parent == "Industrial Tech"] = "#e28f26"
df2$color[df2$parent == "Future Mobility"] = "#6a0dad"
df2$color[df2$parent == "Deep Tech" ] = "#669999"
df2$color[df2$parent == "Defense Tech"] = "#8B4513"
#df2 = unique (df2[, c("org", "desc", "count", "domain", "parent", "geo", "color", "parent2")])
df2 = df2[, c("domain", "org", "geo" , "count" ,"parent", "color" )]
#df2 <- df2 %>%
# group_by(org, desc, count, parent, geo, color, parent2) %>%
# summarise(domain = paste(domain, collapse = ", "), .groups = "drop")
#df2 <- df2 %>%
#group_by(org, count, parent, geo, color, parent2) %>%
#summarise(domain = paste(domain, collapse = ", "), .groups = "drop")
df2$org <- gsub("(^|[[:space:]])([[:alpha:]])", "\\1\\U\\2", tolower(df2$org), perl = TRUE)
df2$org[grepl("^Volkswagen", df2$org, ignore.case = TRUE)] <- "Volkswagen Ag"
df2$org[grepl("^Continental", df2$org, ignore.case = TRUE)] <- "Continental Automotive Gmbh"
df2$org[grepl("^Contitech", df2$org, ignore.case = TRUE)] <- "Contitech Ag"
df2$org[grepl("^Amazonen", df2$org, ignore.case = TRUE)] <- "Amazonen-werke H. Dreyer Se & Co. Kg"
df2$org[grepl("^Sartorius", df2$org, ignore.case = TRUE)] <- "Sartorius Stedim Biotech Gmbh"
df2$org[grepl("^Vitesco", df2$org, ignore.case = TRUE)] <- "Vitesco Technologies Gmbh"
df2$org[grepl("^Kws Saat", df2$org, ignore.case = TRUE)] <- "Kws Saat Se & Co. Kgaa"
df2$org[grepl("^Ottobock", df2$org, ignore.case = TRUE)] <- "Ottobock Se & Co. Kgaa"
df2$org[grepl("^Rheinmetall", df2$org, ignore.case = TRUE)] <- "Rheinmetall Waffe Munition Gmbh"
df2$org[grepl("^Abberior", df2$org, ignore.case = TRUE)] <- "Abberior Instruments Gmbh"
df2$org[grepl("^Grimme", df2$org, ignore.case = TRUE)] <- "Grimme Landmaschinenfabrik Gmbh & Co. Kg"
df2$org[grepl("^Vogelsang", df2$org, ignore.case = TRUE)] <- "Vogelsang Gmbh & Co. Kg"
df2$org[grepl("^Focke", df2$org, ignore.case = TRUE)] <- "Focke & Co. (gmbh & Co. Kg)"
df2$org[grepl("^Basf Polyurethanes", df2$org, ignore.case = TRUE)] <- "Basf Polyurethanes Gmbh"
df2$count = ave(df2$count, paste0(df2$org, df2$domain), FUN = sum)
df2 = unique (df2)
dff = df2
dff$count = ave(dff$count, dff$org, FUN = sum)
dff = unique (dff[, c("org", "count")])
### keep only top/snapshot
df_all = df2
df_all <- df_all[order(df_all$domain, -df_all$count), ]
# Step 2: pick one top org per domain, avoiding duplicates when possible
used_orgs <- c()
out <- data.frame()
for(d in unique(df_all$domain)){
tmp <- df_all[df_all$domain == d, ]
# Try to pick first org not yet used
pick <- tmp[!(tmp$org %in% used_orgs), ]
if(nrow(pick) == 0) pick <- tmp[1, ]   # if all orgs used, still take top one
out <- rbind(out, pick[1, ])
used_orgs <- c(used_orgs, pick$org[1])
}
out
capitalize_words <- function(s) {
s <- tolower(s)
s <- gsub("\\b([a-z])", "\\U\\1", s, perl = TRUE)
return(s)
}
out$org = capitalize_words (out$org)
out$count = ave(out$count, out$org, FUN = sum)
out$id = out$org
out$value = out$count
out = unique (out)
dir.create(paste0(dir, "/3-viz/ecosystems/", j, "/", i, "/", data), recursive = TRUE, showWarnings = FALSE)
setwd(paste0(dir, "/3-viz/ecosystems/", j, "/", i, "/", data))
writeLines(paste (p1, toJSON(out, pretty = TRUE), p3, collapse="\n"), paste0("all.html"))
df3 = df2
k = "Batteries"
for (k in unique(df3$domain)){
df2 = subset (df3, df3$domain == k)
capitalize_words <- function(s) {
s <- tolower(s)
s <- gsub("\\b([a-z])", "\\U\\1", s, perl = TRUE)
return(s)
}
df2$org = capitalize_words (df2$org)
df2$count = ave(df2$count, df2$org, FUN = sum)
df2$id = df2$org
df2$value = df2$count
df2 = unique (df2)
k <- tolower (gsub(" ", "-", k))
if (k == "ccs-/-ccu"){ k = "ccs"}
dir.create(paste0(dir, "/3-viz/ecosystems/", j, "/", i, "/", data), recursive = TRUE, showWarnings = FALSE)
setwd(paste0(dir, "/3-viz/ecosystems/", j, "/", i, "/", data))
writeLines(paste (p1, toJSON(df2, pretty = TRUE), p3, collapse="\n"), paste0(k, ".html"))
}
# MISTAKE WITH Anaveon
# SELECTORS
data = "openalex"
#data = "regpat"
#data = "crunchbase"
p = "5-lower-saxony"
j <- "nuts2_ls"  # GEO
root = "~/Library/CloudStorage/Dropbox/1-asg/1-build"
dir = paste0(root, "/3-projects/", p) # WHERE DATA LOADS
i <- "kst" # "topic"; "wipo"; "all"; "aiw"
# CODE
library(data.table)
library(jsonlite)
library(stringr)
library(dplyr)
setwd("~/Library/CloudStorage/Dropbox/1-asg/1-build/2-code")
source("save.to.directory.R")
source("get_rca_colors.R")
# LOAD PARENTS
setwd(paste0(dir, "/0-custom/domain/", i))
parents <- unique(fread("index.csv")[, c("domain", "parent")])
# ORG-DOMAIN FILES
setwd(paste0(dir, "/3-viz/ecosystems/_source"))
p1 = paste(readLines("part-1.html"), collapse="\n") #before json data
p3 = paste(readLines("part-3.html"), collapse="\n") #after json data
setwd(paste0(dir, "/2-complexity/org/", j, "/", i,  "/", data))
df = read.csv(list.files()[which.max(as.numeric(sub(".*-(\\d{4})\\.csv", "\\1", list.files())))]) # read the latest file
df = merge (df, parents, by = "domain")
df$flag <- ifelse(grepl("\\(.*?\\).*?\\(.*?\\)", df$geo), 1, 0)
if (data == "regpat"){se <- subset (df, df$geo == "Lower Saxony (DE9)")}
if (data == "openalex"){se <- subset (df, df$geo == "Lower Saxony (DE9)")}
if (data == "crunchbase"){se <- subset (df, df$geo == "Lower Saxony (DE9) (DE9)")}
k = unique (se$geo)
df2 = subset (df, df$geo %in% k)
df2$color[df2$parent == "ICT"] = "#365a94"
df2$color[df2$parent == "Climate Tech"] = "#8cab79"
df2$color[df2$parent == "AgriFood Tech"] = "#800020"
df2$color[df2$parent == "Life Sciences"] = "#EEDC82"
df2$color[df2$parent == "Industrial Tech"] = "#e28f26"
df2$color[df2$parent == "Future Mobility"] = "#6a0dad"
df2$color[df2$parent == "Deep Tech" ] = "#669999"
df2$color[df2$parent == "Defense Tech"] = "#8B4513"
#df2 = unique (df2[, c("org", "desc", "count", "domain", "parent", "geo", "color", "parent2")])
df2 = df2[, c("domain", "org", "geo" , "count" ,"parent", "color" )]
#df2 <- df2 %>%
# group_by(org, desc, count, parent, geo, color, parent2) %>%
# summarise(domain = paste(domain, collapse = ", "), .groups = "drop")
#df2 <- df2 %>%
#group_by(org, count, parent, geo, color, parent2) %>%
#summarise(domain = paste(domain, collapse = ", "), .groups = "drop")
df2$org <- gsub("(^|[[:space:]])([[:alpha:]])", "\\1\\U\\2", tolower(df2$org), perl = TRUE)
df2$org[grepl("^Volkswagen", df2$org, ignore.case = TRUE)] <- "Volkswagen Ag"
df2$org[grepl("^Continental", df2$org, ignore.case = TRUE)] <- "Continental Automotive Gmbh"
df2$org[grepl("^Contitech", df2$org, ignore.case = TRUE)] <- "Contitech Ag"
df2$org[grepl("^Amazonen", df2$org, ignore.case = TRUE)] <- "Amazonen-werke H. Dreyer Se & Co. Kg"
df2$org[grepl("^Sartorius", df2$org, ignore.case = TRUE)] <- "Sartorius Stedim Biotech Gmbh"
df2$org[grepl("^Vitesco", df2$org, ignore.case = TRUE)] <- "Vitesco Technologies Gmbh"
df2$org[grepl("^Kws Saat", df2$org, ignore.case = TRUE)] <- "Kws Saat Se & Co. Kgaa"
df2$org[grepl("^Ottobock", df2$org, ignore.case = TRUE)] <- "Ottobock Se & Co. Kgaa"
df2$org[grepl("^Rheinmetall", df2$org, ignore.case = TRUE)] <- "Rheinmetall Waffe Munition Gmbh"
df2$org[grepl("^Abberior", df2$org, ignore.case = TRUE)] <- "Abberior Instruments Gmbh"
df2$org[grepl("^Grimme", df2$org, ignore.case = TRUE)] <- "Grimme Landmaschinenfabrik Gmbh & Co. Kg"
df2$org[grepl("^Vogelsang", df2$org, ignore.case = TRUE)] <- "Vogelsang Gmbh & Co. Kg"
df2$org[grepl("^Focke", df2$org, ignore.case = TRUE)] <- "Focke & Co. (gmbh & Co. Kg)"
df2$org[grepl("^Basf Polyurethanes", df2$org, ignore.case = TRUE)] <- "Basf Polyurethanes Gmbh"
df2$count = ave(df2$count, paste0(df2$org, df2$domain), FUN = sum)
df2 = unique (df2)
dff = df2
dff$count = ave(dff$count, dff$org, FUN = sum)
dff = unique (dff[, c("org", "count")])
### keep only top/snapshot
df_all = df2
df_all <- df_all[order(df_all$domain, -df_all$count), ]
# Step 2: pick one top org per domain, avoiding duplicates when possible
used_orgs <- c()
out <- data.frame()
for(d in unique(df_all$domain)){
tmp <- df_all[df_all$domain == d, ]
# Try to pick first org not yet used
pick <- tmp[!(tmp$org %in% used_orgs), ]
if(nrow(pick) == 0) pick <- tmp[1, ]   # if all orgs used, still take top one
out <- rbind(out, pick[1, ])
used_orgs <- c(used_orgs, pick$org[1])
}
out
capitalize_words <- function(s) {
s <- tolower(s)
s <- gsub("\\b([a-z])", "\\U\\1", s, perl = TRUE)
return(s)
}
out$org = capitalize_words (out$org)
out$count = ave(out$count, out$org, FUN = sum)
out$id = out$org
out$value = out$count
out = unique (out)
dir.create(paste0(dir, "/3-viz/ecosystems/", j, "/", i, "/", data), recursive = TRUE, showWarnings = FALSE)
setwd(paste0(dir, "/3-viz/ecosystems/", j, "/", i, "/", data))
writeLines(paste (p1, toJSON(out, pretty = TRUE), p3, collapse="\n"), paste0("all.html"))
df3 = df2
k = "Batteries"
for (k in unique(df3$domain)){
df2 = subset (df3, df3$domain == k)
capitalize_words <- function(s) {
s <- tolower(s)
s <- gsub("\\b([a-z])", "\\U\\1", s, perl = TRUE)
return(s)
}
df2$org = capitalize_words (df2$org)
df2$count = ave(df2$count, df2$org, FUN = sum)
df2$id = df2$org
df2$value = df2$count
df2 = unique (df2)
k <- tolower (gsub(" ", "-", k))
if (k == "ccs-/-ccu"){ k = "ccs"}
dir.create(paste0(dir, "/3-viz/ecosystems/", j, "/", i, "/", data), recursive = TRUE, showWarnings = FALSE)
setwd(paste0(dir, "/3-viz/ecosystems/", j, "/", i, "/", data))
writeLines(paste (p1, toJSON(df2, pretty = TRUE), p3, collapse="\n"), paste0(k, ".html"))
}
# MISTAKE WITH Anaveon
# SELECTORS
data = "openalex"
data = "regpat"
data = "crunchbase"
p = "5-lower-saxony"
j <- "nuts2_ls"  # GEO
root = "~/Library/CloudStorage/Dropbox/1-asg/1-build"
dir = paste0(root, "/3-projects/", p) # WHERE DATA LOADS
i <- "kst" # "topic"; "wipo"; "all"; "aiw"
# CODE
library(data.table)
library(jsonlite)
library(stringr)
library(dplyr)
setwd("~/Library/CloudStorage/Dropbox/1-asg/1-build/2-code")
source("save.to.directory.R")
source("get_rca_colors.R")
# LOAD PARENTS
setwd(paste0(dir, "/0-custom/domain/", i))
parents <- unique(fread("index.csv")[, c("domain", "parent")])
# ORG-DOMAIN FILES
setwd(paste0(dir, "/3-viz/ecosystems/_source"))
p1 = paste(readLines("part-1.html"), collapse="\n") #before json data
p3 = paste(readLines("part-3.html"), collapse="\n") #after json data
setwd(paste0(dir, "/2-complexity/org/", j, "/", i,  "/", data))
df = read.csv(list.files()[which.max(as.numeric(sub(".*-(\\d{4})\\.csv", "\\1", list.files())))]) # read the latest file
df = merge (df, parents, by = "domain")
df$flag <- ifelse(grepl("\\(.*?\\).*?\\(.*?\\)", df$geo), 1, 0)
if (data == "regpat"){se <- subset (df, df$geo == "Lower Saxony (DE9)")}
if (data == "openalex"){se <- subset (df, df$geo == "Lower Saxony (DE9)")}
if (data == "crunchbase"){se <- subset (df, df$geo == "Lower Saxony (DE9) (DE9)")}
k = unique (se$geo)
df2 = subset (df, df$geo %in% k)
df2$color[df2$parent == "ICT"] = "#365a94"
df2$color[df2$parent == "Climate Tech"] = "#8cab79"
df2$color[df2$parent == "AgriFood Tech"] = "#800020"
df2$color[df2$parent == "Life Sciences"] = "#EEDC82"
df2$color[df2$parent == "Industrial Tech"] = "#e28f26"
df2$color[df2$parent == "Future Mobility"] = "#6a0dad"
df2$color[df2$parent == "Deep Tech" ] = "#669999"
df2$color[df2$parent == "Defense Tech"] = "#8B4513"
#df2 = unique (df2[, c("org", "desc", "count", "domain", "parent", "geo", "color", "parent2")])
df2 = df2[, c("domain", "org", "geo" , "count" ,"parent", "color" )]
#df2 <- df2 %>%
# group_by(org, desc, count, parent, geo, color, parent2) %>%
# summarise(domain = paste(domain, collapse = ", "), .groups = "drop")
#df2 <- df2 %>%
#group_by(org, count, parent, geo, color, parent2) %>%
#summarise(domain = paste(domain, collapse = ", "), .groups = "drop")
df2$org <- gsub("(^|[[:space:]])([[:alpha:]])", "\\1\\U\\2", tolower(df2$org), perl = TRUE)
df2$org[grepl("^Volkswagen", df2$org, ignore.case = TRUE)] <- "Volkswagen Ag"
df2$org[grepl("^Continental", df2$org, ignore.case = TRUE)] <- "Continental Automotive Gmbh"
df2$org[grepl("^Contitech", df2$org, ignore.case = TRUE)] <- "Contitech Ag"
df2$org[grepl("^Amazonen", df2$org, ignore.case = TRUE)] <- "Amazonen-werke H. Dreyer Se & Co. Kg"
df2$org[grepl("^Sartorius", df2$org, ignore.case = TRUE)] <- "Sartorius Stedim Biotech Gmbh"
df2$org[grepl("^Vitesco", df2$org, ignore.case = TRUE)] <- "Vitesco Technologies Gmbh"
df2$org[grepl("^Kws Saat", df2$org, ignore.case = TRUE)] <- "Kws Saat Se & Co. Kgaa"
df2$org[grepl("^Ottobock", df2$org, ignore.case = TRUE)] <- "Ottobock Se & Co. Kgaa"
df2$org[grepl("^Rheinmetall", df2$org, ignore.case = TRUE)] <- "Rheinmetall Waffe Munition Gmbh"
df2$org[grepl("^Abberior", df2$org, ignore.case = TRUE)] <- "Abberior Instruments Gmbh"
df2$org[grepl("^Grimme", df2$org, ignore.case = TRUE)] <- "Grimme Landmaschinenfabrik Gmbh & Co. Kg"
df2$org[grepl("^Vogelsang", df2$org, ignore.case = TRUE)] <- "Vogelsang Gmbh & Co. Kg"
df2$org[grepl("^Focke", df2$org, ignore.case = TRUE)] <- "Focke & Co. (gmbh & Co. Kg)"
df2$org[grepl("^Basf Polyurethanes", df2$org, ignore.case = TRUE)] <- "Basf Polyurethanes Gmbh"
df2$count = ave(df2$count, paste0(df2$org, df2$domain), FUN = sum)
df2 = unique (df2)
dff = df2
dff$count = ave(dff$count, dff$org, FUN = sum)
dff = unique (dff[, c("org", "count")])
### keep only top/snapshot
df_all = df2
df_all <- df_all[order(df_all$domain, -df_all$count), ]
# Step 2: pick one top org per domain, avoiding duplicates when possible
used_orgs <- c()
out <- data.frame()
for(d in unique(df_all$domain)){
tmp <- df_all[df_all$domain == d, ]
# Try to pick first org not yet used
pick <- tmp[!(tmp$org %in% used_orgs), ]
if(nrow(pick) == 0) pick <- tmp[1, ]   # if all orgs used, still take top one
out <- rbind(out, pick[1, ])
used_orgs <- c(used_orgs, pick$org[1])
}
out
capitalize_words <- function(s) {
s <- tolower(s)
s <- gsub("\\b([a-z])", "\\U\\1", s, perl = TRUE)
return(s)
}
out$org = capitalize_words (out$org)
out$count = ave(out$count, out$org, FUN = sum)
out$id = out$org
out$value = out$count
out = unique (out)
dir.create(paste0(dir, "/3-viz/ecosystems/", j, "/", i, "/", data), recursive = TRUE, showWarnings = FALSE)
setwd(paste0(dir, "/3-viz/ecosystems/", j, "/", i, "/", data))
writeLines(paste (p1, toJSON(out, pretty = TRUE), p3, collapse="\n"), paste0("all.html"))
df3 = df2
k = "Batteries"
for (k in unique(df3$domain)){
df2 = subset (df3, df3$domain == k)
capitalize_words <- function(s) {
s <- tolower(s)
s <- gsub("\\b([a-z])", "\\U\\1", s, perl = TRUE)
return(s)
}
df2$org = capitalize_words (df2$org)
df2$count = ave(df2$count, df2$org, FUN = sum)
df2$id = df2$org
df2$value = df2$count
df2 = unique (df2)
k <- tolower (gsub(" ", "-", k))
if (k == "ccs-/-ccu"){ k = "ccs"}
dir.create(paste0(dir, "/3-viz/ecosystems/", j, "/", i, "/", data), recursive = TRUE, showWarnings = FALSE)
setwd(paste0(dir, "/3-viz/ecosystems/", j, "/", i, "/", data))
writeLines(paste (p1, toJSON(df2, pretty = TRUE), p3, collapse="\n"), paste0(k, ".html"))
}
folder <- setwd(dirname(sys.script()))
folder <- setwd(dirname(sys.frame(1)$ofile))
folder <- setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
folder <- setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
files <- list.files(folder, recursive = TRUE, full.names = TRUE)
writeLines(files, "links.txt")
files
files_web <- gsub(
"^/Users/pierre-alex/Library/CloudStorage/Dropbox/GitHub/PABalland.github.io",
"https://www.paballand.com",
files
)
folder <- setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
files <- list.files(folder, recursive = TRUE, full.names = TRUE)
files <- gsub("^/Users/pierre-alex/Library/CloudStorage/Dropbox/GitHub/PABalland.github.io", "https://www.paballand.com",files)
writeLines(files, "links.txt")
folder <- setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
files <- list.files(folder, recursive = TRUE, full.names = TRUE)
files <- gsub("^/Users/pierre-alex/Library/CloudStorage/Dropbox/GitHub/PABalland.github.io", "https://www.paballand.com",files)
writeLines(files, "links.txt")
folder <- setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
files <- list.files(folder, recursive = TRUE, full.names = TRUE)
writeLines(files, "links.txt")
folder <- setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
files <- list.files(folder, recursive = TRUE, full.names = TRUE)
files <- gsub("^/Users/pierre-alex/Library/CloudStorage/Dropbox/GitHub/PABalland.github.io", "https://www.paballand.com",files)
writeLines(files, "links.txt")
folder <- setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
files <- list.files(folder, recursive = TRUE, full.names = TRUE)
files <- gsub("^/Users/pierre-alex/Library/CloudStorage/Dropbox/GitHub/PABalland.github.io", "https://www.paballand.com",files)
writeLines(files, "links.txt")
folder <- setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
files <- list.files(folder, recursive = TRUE, full.names = TRUE)
files <- files[!grepl("_archives|_old", files)]
files <- gsub("^/Users/pierre-alex/Library/CloudStorage/Dropbox/GitHub/PABalland.github.io", "https://www.paballand.com",files)
writeLines(files, "links.txt")
folder <- setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
files <- list.files(folder, recursive = TRUE, full.names = TRUE)
files <- files[grepl("\\.html$", files) & !grepl("_archives|_old", files)]
files <- gsub("^/Users/pierre-alex/Library/CloudStorage/Dropbox/GitHub/PABalland.github.io", "https://www.paballand.com",files)
writeLines(files, "links.txt")
