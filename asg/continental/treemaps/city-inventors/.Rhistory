# read app info
setwd(dir.regpat)
app = fread ("pctnb-app-reg.csv", sep = ",", header = T)
app$ctry = substr(app$reg_code, 0, 2)
app = app %>% distinct ()
df = inner_join(df, app, by = "pct_nbr")
df$year = as.numeric(substr(df$pct_nbr, 3, 6))
df = subset (df, df$year >= 2017) # select period
df$year = NULL
# merge with fua information
setwd(dir.regpat)
reg.att = read.csv2 ("reg-att.csv")[, c("reg_code", "fua_id", "fua_name")] %>% distinct()
df = inner_join(df, reg.att, by = "reg_code") # merge to get priority years
df$reg_code = NULL
df = df %>% distinct()
df <- df[complete.cases(df), ]
df$freq = 1
df$ID = paste0(df$priority, df$app_name, df$fua_name)
df$count = ave(df$freq, df$ID, FUN = sum)
df$countcity = ave(df$freq, df$fua_name, FUN = sum)
df = df[order(df$countcity),]
View(df)
df = df[order(-df$countcity),]
View(df)
df = df[, c("priority", "app_name", "fua_id", "fua_name", "count", "ctry")]
df = df %>% distinct ()
View(df)
df$region = df$fua_name
links = NULL
for (i in unique (df$region)) {
#i = "Toulouse"
sub = subset (df, df$region == i)
sub$id = sub$app_name
sub$value = sub$count
sub$sum = ave(sub$count, sub$fua_name, FUN = sum)
sub$share = round (sub$count*100/sub$sum, digits = 2)
sub$count.all = ave(sub$count, sub$app_name, FUN = sum)
sub$sum.all = sum(sub$count)
sub$shareall = round (sub$count.all*100/sub$sum.all, digits = 2)
sub$color = "lightblue"
sub$color[sub$priority == "Head-up displays"] = "orange"
sub$color[sub$priority == "Computer-aided design [CAD]"] = "red"
sub$color[sub$priority == "Optical systems (general)"] = "yellow"
sub$color[sub$priority == "Holography"] = "green"
sub$color[sub$priority == "Screen displays (vehicules)"] = "blue"
sub$color[sub$priority == "Optical Components"] = "lightgreen"
sub$color[sub$priority == "Automotive ECUs" ] = "lightred"
sub$color[sub$priority == "Arrangement for software engineering"] = "lightblue"
sub$parent = sub$priority
sub$rca = 0
sub = unique(sub[,  c("parent", "id", "value", "color", "share", "rca", "shareall", "ctry")])
sub = sub[complete.cases(sub),]
p2 = toJSON(sub)
all = paste (p1, p2, p3, collapse="\n")
setwd(paste0(dir, "/3-outputs/treemaps/city-applicants"))
i = iconv(i, to = 'ASCII//TRANSLIT')
i = gsub(" ", "-", i, fixed = TRUE)
i = gsub("/", "-", i, fixed = TRUE)
i = gsub(",", "-", i, fixed = TRUE)
i = gsub("(", "-", i, fixed = TRUE)
i = gsub(")", "", i, fixed = TRUE)
i = gsub("--", "-", i, fixed = TRUE)
i = gsub("-.", ".", i, fixed = TRUE)
i = gsub("ß", "ss", i, fixed = TRUE)
i = gsub("?", "ss", i, fixed = TRUE)
i = tolower (i)
writeLines(all, paste0(i, ".html"))
setwd(paste0(web, "/treemaps/city-applicants"))
writeLines(all, paste0(i, ".html"))
sub = sub[, c("id",	"value", "share", "ctry")]
sub = sub[order(-sub$value), ]
#write.csv2(sub, paste0(i, ".csv"), row.names = F)
# add names for links
root = "https://www.paballand.com/asg/continental/treemaps/city-applicants/"
d = data.frame (link = paste0(root, i, ".html)"))
links = rbind (d, links)
}
links
View(links)
head(df)
write.table(links, "links.txt", row.names = F)
options(stringsAsFactors=FALSE)
library (jsonlite)
library (EconGeo)
library (RColorBrewer)
library (data.table)
library (dplyr)
dir  = "D:/Dropbox/2-private/1-asg/1-production/2-continental" # for analysis
dir.regpat = "D:/Dropbox/2-private/1-asg/1-production/_DATA/PATENTS/REGPAT" # for latest regpat version
web = "D:/Dropbox/2-private/PABalland.github.io/asg/continental"
# load different parts of html
setwd("D:/Dropbox/2-private/1-asg/1-production/_SOURCE/treemaps")
p1 = paste(readLines("part-1.html"), collapse="\n") #before json data
p3 = paste(readLines("part-3-patents-applicants.html"), collapse="\n") #after json data
setwd("D:/Dropbox/2-private/1-asg/1-production/_SOURCE")
source ("prettyprint.df.R")
# read priorities
setwd(paste0(dir, "/1-data"))
df = fread ("pctnb-prio.csv", sep = ",", header = T)
# read app info
setwd(dir.regpat)
app = fread ("pctnb-app-reg.csv", sep = ",", header = T)
app$ctry = substr(app$reg_code, 0, 2)
app = app %>% distinct ()
df = inner_join(df, app, by = "pct_nbr")
df$year = as.numeric(substr(df$pct_nbr, 3, 6))
df = subset (df, df$year >= 2017) # select period
df$year = NULL
# merge with fua information
setwd(dir.regpat)
reg.att = read.csv2 ("reg-att.csv")[, c("reg_code", "fua_id", "fua_name")] %>% distinct()
df = inner_join(df, reg.att, by = "reg_code") # merge to get priority years
df$reg_code = NULL
df = df %>% distinct()
df <- df[complete.cases(df), ]
df$freq = 1
df$ID = paste0(df$priority, df$app_name, df$fua_name)
df$count = ave(df$freq, df$ID, FUN = sum)
df$countcity = ave(df$freq, df$fua_name, FUN = sum)
df = df[order(df$countcity),]
df = df[, c("priority", "app_name", "fua_id", "fua_name", "count", "ctry")]
df = df %>% distinct ()
df$region = df$fua_name
links = NULL
for (i in unique (df$region)) {
#i = "Toulouse"
sub = subset (df, df$region == i)
sub$id = sub$app_name
sub$value = sub$count
sub$sum = ave(sub$count, sub$fua_name, FUN = sum)
sub$share = round (sub$count*100/sub$sum, digits = 2)
sub$count.all = ave(sub$count, sub$app_name, FUN = sum)
sub$sum.all = sum(sub$count)
sub$shareall = round (sub$count.all*100/sub$sum.all, digits = 2)
sub$color = "lightblue"
sub$color[sub$priority == "Head-up displays"] = "orange"
sub$color[sub$priority == "Computer-aided design [CAD]"] = "red"
sub$color[sub$priority == "Optical systems (general)"] = "yellow"
sub$color[sub$priority == "Holography"] = "green"
sub$color[sub$priority == "Screen displays (vehicules)"] = "blue"
sub$color[sub$priority == "Optical Components"] = "lightgreen"
sub$color[sub$priority == "Automotive ECUs" ] = "lightred"
sub$color[sub$priority == "Arrangement for software engineering"] = "lightblue"
sub$parent = sub$priority
sub$rca = 0
sub = unique(sub[,  c("parent", "id", "value", "color", "share", "rca", "shareall", "ctry")])
sub = sub[complete.cases(sub),]
p2 = toJSON(sub)
all = paste (p1, p2, p3, collapse="\n")
setwd(paste0(dir, "/3-outputs/treemaps/city-applicants"))
i = iconv(i, to = 'ASCII//TRANSLIT')
i = gsub(" ", "-", i, fixed = TRUE)
i = gsub("/", "-", i, fixed = TRUE)
i = gsub(",", "-", i, fixed = TRUE)
i = gsub("(", "-", i, fixed = TRUE)
i = gsub(")", "", i, fixed = TRUE)
i = gsub("--", "-", i, fixed = TRUE)
i = gsub("-.", ".", i, fixed = TRUE)
i = gsub("ß", "ss", i, fixed = TRUE)
i = gsub("?", "ss", i, fixed = TRUE)
i = tolower (i)
writeLines(all, paste0(i, ".html"))
setwd(paste0(web, "/treemaps/city-applicants"))
writeLines(all, paste0(i, ".html"))
sub = sub[, c("id",	"value", "share", "ctry")]
sub = sub[order(-sub$value), ]
#write.csv2(sub, paste0(i, ".csv"), row.names = F)
# add names for links
root = "https://www.paballand.com/asg/continental/treemaps/city-applicants/"
d = data.frame (link = paste0(root, i, ".html)"))
links = rbind (d, links)
}
write.table(links, "links.txt", row.names = F)
#df = df[, c("priority", "app_name", "count", "shareall", "ctry")]
#setwd(paste0(web, "/treemaps/applicants"))
#write.csv2(df, "applicants.csv", row.names = F)
#df = subset (df, df$count>1)
#setwd(paste0(dir, "/3-outputs/treemaps/assignees"))
#dtdata1 <- datatable (df, filter = 'top')
#DT::saveWidget(dtdata1, "inventors.html")
#setwd(paste0(web, "/treemaps/assignees"))
#DT::saveWidget(dtdata1, "inventors.html")
View(links)
head(links)
setwd("D:/Dropbox/2-private/1-asg/1-production/2-continental/3-outputs/treemaps/city-applicants")
options(stringsAsFactors=FALSE)
library (jsonlite)
library (EconGeo)
library (RColorBrewer)
library (data.table)
library (dplyr)
dir  = "D:/Dropbox/2-private/1-asg/1-production/2-continental" # for analysis
dir.regpat = "D:/Dropbox/2-private/1-asg/1-production/_DATA/PATENTS/REGPAT" # for latest regpat version
web = "D:/Dropbox/2-private/PABalland.github.io/asg/continental"
# load different parts of html
setwd("D:/Dropbox/2-private/1-asg/1-production/_SOURCE/treemaps")
p1 = paste(readLines("part-1.html"), collapse="\n") #before json data
p3 = paste(readLines("part-3-patents-applicants.html"), collapse="\n") #after json data
setwd("D:/Dropbox/2-private/1-asg/1-production/_SOURCE")
source ("prettyprint.df.R")
# read priorities
setwd(paste0(dir, "/1-data"))
df = fread ("pctnb-prio.csv", sep = ",", header = T)
# read app info
setwd(dir.regpat)
app = fread ("pctnb-inv-reg.csv", sep = ",", header = T)
app$ctry = substr(app$reg_code, 0, 2)
app = app %>% distinct ()
df = inner_join(df, app, by = "pct_nbr")
df$year = as.numeric(substr(df$pct_nbr, 3, 6))
df = subset (df, df$year >= 2017) # select period
df$year = NULL
# merge with fua information
setwd(dir.regpat)
reg.att = read.csv2 ("reg-att.csv")[, c("reg_code", "fua_id", "fua_name")] %>% distinct()
df = inner_join(df, reg.att, by = "reg_code") # merge to get priority years
df$reg_code = NULL
df = df %>% distinct()
df <- df[complete.cases(df), ]
df$freq = 1
df$ID = paste0(df$priority, df$inv_name, df$fua_name)
df$count = ave(df$freq, df$ID, FUN = sum)
df$countcity = ave(df$freq, df$fua_name, FUN = sum)
df = df[order(df$countcity),]
df = df[, c("priority", "inv_name", "fua_id", "fua_name", "count", "ctry")]
df = df %>% distinct ()
df$region = df$fua_name
options(stringsAsFactors=FALSE)
library (jsonlite)
library (EconGeo)
library (RColorBrewer)
library (data.table)
library (dplyr)
dir  = "D:/Dropbox/2-private/1-asg/1-production/2-continental" # for analysis
dir.regpat = "D:/Dropbox/2-private/1-asg/1-production/_DATA/PATENTS/REGPAT" # for latest regpat version
web = "D:/Dropbox/2-private/PABalland.github.io/asg/continental"
# load different parts of html
setwd("D:/Dropbox/2-private/1-asg/1-production/_SOURCE/treemaps")
p1 = paste(readLines("part-1.html"), collapse="\n") #before json data
p3 = paste(readLines("part-3-patents-applicants.html"), collapse="\n") #after json data
setwd("D:/Dropbox/2-private/1-asg/1-production/_SOURCE")
source ("prettyprint.df.R")
# read priorities
setwd(paste0(dir, "/1-data"))
df = fread ("pctnb-prio.csv", sep = ",", header = T)
# read app info
setwd(dir.regpat)
app = fread ("pctnb-inv-reg.csv", sep = ",", header = T)
app$ctry = substr(app$reg_code, 0, 2)
app = app %>% distinct ()
df = inner_join(df, app, by = "pct_nbr")
df$year = as.numeric(substr(df$pct_nbr, 3, 6))
df = subset (df, df$year >= 2017) # select period
df$year = NULL
# merge with fua information
setwd(dir.regpat)
reg.att = read.csv2 ("reg-att.csv")[, c("reg_code", "fua_id", "fua_name")] %>% distinct()
df = inner_join(df, reg.att, by = "reg_code") # merge to get priority years
df$reg_code = NULL
df = df %>% distinct()
df <- df[complete.cases(df), ]
df$freq = 1
df$ID = paste0(df$priority, df$inv_name, df$fua_name)
df$count = ave(df$freq, df$ID, FUN = sum)
df$countcity = ave(df$freq, df$fua_name, FUN = sum)
df = df[order(df$countcity),]
df = df[, c("priority", "inv_name", "fua_id", "fua_name", "count", "ctry")]
df = df %>% distinct ()
df$region = df$fua_name
links = NULL
for (i in unique (df$region)) {
#i = "Toulouse"
sub = subset (df, df$region == i)
sub$id = sub$inv_name
sub$value = sub$count
sub$sum = ave(sub$count, sub$fua_name, FUN = sum)
sub$share = round (sub$count*100/sub$sum, digits = 2)
sub$count.all = ave(sub$count, sub$inv_name, FUN = sum)
sub$sum.all = sum(sub$count)
sub$shareall = round (sub$count.all*100/sub$sum.all, digits = 2)
sub$color = "lightblue"
sub$color[sub$priority == "Head-up displays"] = "orange"
sub$color[sub$priority == "Computer-aided design [CAD]"] = "red"
sub$color[sub$priority == "Optical systems (general)"] = "yellow"
sub$color[sub$priority == "Holography"] = "green"
sub$color[sub$priority == "Screen displays (vehicules)"] = "blue"
sub$color[sub$priority == "Optical Components"] = "lightgreen"
sub$color[sub$priority == "Automotive ECUs" ] = "lightred"
sub$color[sub$priority == "Arrangement for software engineering"] = "lightblue"
sub$parent = sub$priority
sub$rca = 0
sub = unique(sub[,  c("parent", "id", "value", "color", "share", "rca", "shareall", "ctry")])
sub = sub[complete.cases(sub),]
p2 = toJSON(sub)
all = paste (p1, p2, p3, collapse="\n")
setwd(paste0(dir, "/3-outputs/treemaps/city-inventors"))
i = iconv(i, to = 'ASCII//TRANSLIT')
i = gsub(" ", "-", i, fixed = TRUE)
i = gsub("/", "-", i, fixed = TRUE)
i = gsub(",", "-", i, fixed = TRUE)
i = gsub("(", "-", i, fixed = TRUE)
i = gsub(")", "", i, fixed = TRUE)
i = gsub("--", "-", i, fixed = TRUE)
i = gsub("-.", ".", i, fixed = TRUE)
i = gsub("ß", "ss", i, fixed = TRUE)
i = gsub("?", "ss", i, fixed = TRUE)
i = tolower (i)
writeLines(all, paste0(i, ".html"))
setwd(paste0(web, "/treemaps/city-inventors"))
writeLines(all, paste0(i, ".html"))
sub = sub[, c("id",	"value", "share", "ctry")]
sub = sub[order(-sub$value), ]
#write.csv2(sub, paste0(i, ".csv"), row.names = F)
# add names for links
root = "https://www.paballand.com/asg/continental/treemaps/city-inventors/"
d = data.frame (link = paste0(root, i, ".html)"))
links = rbind (d, links)
}
write.table(links, "links.txt", row.names = F)
options(stringsAsFactors=FALSE)
library (jsonlite)
library (EconGeo)
library (RColorBrewer)
library (data.table)
library (dplyr)
dir  = "D:/Dropbox/2-private/1-asg/1-production/2-continental" # for analysis
dir.regpat = "D:/Dropbox/2-private/1-asg/1-production/_DATA/PATENTS/REGPAT" # for latest regpat version
web = "D:/Dropbox/2-private/PABalland.github.io/asg/continental"
# load different parts of html
setwd("D:/Dropbox/2-private/1-asg/1-production/_SOURCE/treemaps")
p1 = paste(readLines("part-1.html"), collapse="\n") #before json data
p3 = paste(readLines("part-3-patents-applicants.html"), collapse="\n") #after json data
setwd("D:/Dropbox/2-private/1-asg/1-production/_SOURCE")
source ("prettyprint.df.R")
# read priorities
setwd(paste0(dir, "/1-data"))
df = fread ("pctnb-prio.csv", sep = ",", header = T)
# read app info
setwd(dir.regpat)
app = fread ("pctnb-app-reg.csv", sep = ",", header = T)
app$ctry = substr(app$reg_code, 0, 2)
app = app %>% distinct ()
df = inner_join(df, app, by = "pct_nbr")
df$year = as.numeric(substr(df$pct_nbr, 3, 6))
df = subset (df, df$year >= 2017) # select period
df$year = NULL
# merge with fua information
setwd(dir.regpat)
reg.att = read.csv2 ("reg-att.csv")[, c("reg_code", "fua_id", "fua_name")] %>% distinct()
df = inner_join(df, reg.att, by = "reg_code") # merge to get priority years
df$reg_code = NULL
df = df %>% distinct()
df <- df[complete.cases(df), ]
df$freq = 1
df$ID = paste0(df$priority, df$app_name, df$fua_name)
df$count = ave(df$freq, df$ID, FUN = sum)
df$countcity = ave(df$freq, df$fua_name, FUN = sum)
df = df[order(df$countcity),]
df = df[, c("priority", "app_name", "fua_id", "fua_name", "count", "ctry")]
df = df %>% distinct ()
df$region = df$fua_name
links = NULL
for (i in unique (df$region)) {
#i = "Toulouse"
sub = subset (df, df$region == i)
sub$id = sub$app_name
sub$value = sub$count
sub$sum = ave(sub$count, sub$fua_name, FUN = sum)
sub$share = round (sub$count*100/sub$sum, digits = 2)
sub$count.all = ave(sub$count, sub$app_name, FUN = sum)
sub$sum.all = sum(sub$count)
sub$shareall = round (sub$count.all*100/sub$sum.all, digits = 2)
sub$color = "lightblue"
sub$color[sub$priority == "Head-up displays"] = "orange"
sub$color[sub$priority == "Computer-aided design [CAD]"] = "red"
sub$color[sub$priority == "Optical systems (general)"] = "yellow"
sub$color[sub$priority == "Holography"] = "green"
sub$color[sub$priority == "Screen displays (vehicules)"] = "blue"
sub$color[sub$priority == "Optical Components"] = "lightgreen"
sub$color[sub$priority == "Automotive ECUs" ] = "lightred"
sub$color[sub$priority == "Arrangement for software engineering"] = "lightblue"
sub$parent = sub$priority
sub$rca = 0
sub = unique(sub[,  c("parent", "id", "value", "color", "share", "rca", "shareall", "ctry")])
sub = sub[complete.cases(sub),]
p2 = toJSON(sub)
all = paste (p1, p2, p3, collapse="\n")
setwd(paste0(dir, "/3-outputs/treemaps/city-applicants"))
i = iconv(i, to = 'ASCII//TRANSLIT')
i = gsub(" ", "-", i, fixed = TRUE)
i = gsub("/", "-", i, fixed = TRUE)
i = gsub(",", "-", i, fixed = TRUE)
i = gsub("(", "-", i, fixed = TRUE)
i = gsub(")", "", i, fixed = TRUE)
i = gsub("--", "-", i, fixed = TRUE)
i = gsub("-.", ".", i, fixed = TRUE)
i = gsub("ß", "ss", i, fixed = TRUE)
i = gsub("?", "ss", i, fixed = TRUE)
i = tolower (i)
writeLines(all, paste0(i, ".html"))
setwd(paste0(web, "/treemaps/city-applicants"))
writeLines(all, paste0(i, ".html"))
sub = sub[, c("id",	"value", "share", "ctry")]
sub = sub[order(-sub$value), ]
#write.csv2(sub, paste0(i, ".csv"), row.names = F)
# add names for links
root = "https://www.paballand.com/asg/continental/treemaps/city-applicants/"
d = data.frame (link = paste0(root, i, ".html"))
links = rbind (d, links)
}
write.table(links, "links.txt", row.names = F)
#df = df[, c("priority", "app_name", "count", "shareall", "ctry")]
#setwd(paste0(web, "/treemaps/applicants"))
#write.csv2(df, "applicants.csv", row.names = F)
#df = subset (df, df$count>1)
#setwd(paste0(dir, "/3-outputs/treemaps/assignees"))
#dtdata1 <- datatable (df, filter = 'top')
#DT::saveWidget(dtdata1, "inventors.html")
#setwd(paste0(web, "/treemaps/assignees"))
#DT::saveWidget(dtdata1, "inventors.html")
options(stringsAsFactors=FALSE)
library (jsonlite)
library (EconGeo)
library (RColorBrewer)
library (data.table)
library (dplyr)
dir  = "D:/Dropbox/2-private/1-asg/1-production/2-continental" # for analysis
dir.regpat = "D:/Dropbox/2-private/1-asg/1-production/_DATA/PATENTS/REGPAT" # for latest regpat version
web = "D:/Dropbox/2-private/PABalland.github.io/asg/continental"
# load different parts of html
setwd("D:/Dropbox/2-private/1-asg/1-production/_SOURCE/treemaps")
p1 = paste(readLines("part-1.html"), collapse="\n") #before json data
p3 = paste(readLines("part-3-patents-applicants.html"), collapse="\n") #after json data
setwd("D:/Dropbox/2-private/1-asg/1-production/_SOURCE")
source ("prettyprint.df.R")
# read priorities
setwd(paste0(dir, "/1-data"))
df = fread ("pctnb-prio.csv", sep = ",", header = T)
# read app info
setwd(dir.regpat)
app = fread ("pctnb-inv-reg.csv", sep = ",", header = T)
app$ctry = substr(app$reg_code, 0, 2)
app = app %>% distinct ()
df = inner_join(df, app, by = "pct_nbr")
df$year = as.numeric(substr(df$pct_nbr, 3, 6))
df = subset (df, df$year >= 2017) # select period
df$year = NULL
# merge with fua information
setwd(dir.regpat)
reg.att = read.csv2 ("reg-att.csv")[, c("reg_code", "fua_id", "fua_name")] %>% distinct()
df = inner_join(df, reg.att, by = "reg_code") # merge to get priority years
df$reg_code = NULL
df = df %>% distinct()
df <- df[complete.cases(df), ]
df$freq = 1
df$ID = paste0(df$priority, df$inv_name, df$fua_name)
df$count = ave(df$freq, df$ID, FUN = sum)
df$countcity = ave(df$freq, df$fua_name, FUN = sum)
df = df[order(df$countcity),]
df = df[, c("priority", "inv_name", "fua_id", "fua_name", "count", "ctry")]
df = df %>% distinct ()
df$region = df$fua_name
links = NULL
for (i in unique (df$region)) {
#i = "Toulouse"
sub = subset (df, df$region == i)
sub$id = sub$inv_name
sub$value = sub$count
sub$sum = ave(sub$count, sub$fua_name, FUN = sum)
sub$share = round (sub$count*100/sub$sum, digits = 2)
sub$count.all = ave(sub$count, sub$inv_name, FUN = sum)
sub$sum.all = sum(sub$count)
sub$shareall = round (sub$count.all*100/sub$sum.all, digits = 2)
sub$color = "lightblue"
sub$color[sub$priority == "Head-up displays"] = "orange"
sub$color[sub$priority == "Computer-aided design [CAD]"] = "red"
sub$color[sub$priority == "Optical systems (general)"] = "yellow"
sub$color[sub$priority == "Holography"] = "green"
sub$color[sub$priority == "Screen displays (vehicules)"] = "blue"
sub$color[sub$priority == "Optical Components"] = "lightgreen"
sub$color[sub$priority == "Automotive ECUs" ] = "lightred"
sub$color[sub$priority == "Arrangement for software engineering"] = "lightblue"
sub$parent = sub$priority
sub$rca = 0
sub = unique(sub[,  c("parent", "id", "value", "color", "share", "rca", "shareall", "ctry")])
sub = sub[complete.cases(sub),]
p2 = toJSON(sub)
all = paste (p1, p2, p3, collapse="\n")
setwd(paste0(dir, "/3-outputs/treemaps/city-inventors"))
i = iconv(i, to = 'ASCII//TRANSLIT')
i = gsub(" ", "-", i, fixed = TRUE)
i = gsub("/", "-", i, fixed = TRUE)
i = gsub(",", "-", i, fixed = TRUE)
i = gsub("(", "-", i, fixed = TRUE)
i = gsub(")", "", i, fixed = TRUE)
i = gsub("--", "-", i, fixed = TRUE)
i = gsub("-.", ".", i, fixed = TRUE)
i = gsub("ß", "ss", i, fixed = TRUE)
i = gsub("?", "ss", i, fixed = TRUE)
i = tolower (i)
writeLines(all, paste0(i, ".html"))
setwd(paste0(web, "/treemaps/city-inventors"))
writeLines(all, paste0(i, ".html"))
sub = sub[, c("id",	"value", "share", "ctry")]
sub = sub[order(-sub$value), ]
#write.csv2(sub, paste0(i, ".csv"), row.names = F)
# add names for links
root = "https://www.paballand.com/asg/continental/treemaps/city-inventors/"
d = data.frame (link = paste0(root, i, ".html"))
links = rbind (d, links)
}
write.table(links, "links.txt", row.names = F)
